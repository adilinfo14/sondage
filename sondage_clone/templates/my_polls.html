{% extends "base.html" %}

{% block content %}
<section class="card hero">
    <h1>Mes sondages</h1>
</section>

<section class="card">
    <h2>Sondages actifs</h2>
    {% if active_polls %}
    <div class="polls-grid">
        {% for poll in active_polls %}
        <article class="result-card poll-card">
            <p class="slot-label">{{ poll.title }}</p>
            <p class="meta">Type : {{ poll_type_labels.get(poll.poll_type, poll.poll_type) }}</p>
            <p class="meta">Mode : {{ response_mode_labels.get(poll.response_mode, poll.response_mode) }}</p>
            <p class="meta">Participants votants : {{ poll.votes_count }}</p>
            <p class="meta">Cr√©√© le : {{ poll.created_at | datetime_fr }}</p>
            <div class="poll-card-actions" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
                <a href="{{ url_for('view_poll', token=poll.token) }}" class="btn-poll-action poll-action-open"
                    title="Voir et partager le sondage">
                    <span>üîó</span> Ouvrir
                </a>
                {% if poll.votes_count == 0 %}
                <a href="{{ url_for('edit_poll', token=poll.token) }}" class="btn-poll-action poll-action-edit"
                    title="Modifier ce sondage">
                    <span>‚úèÔ∏è</span> Modifier
                </a>
                {% endif %}
                <form action="{{ url_for('archive_poll', token=poll.token) }}" method="post"
                    class="poll-card-action-form" style="margin:0;display:inline;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="action" value="archive">
                    <button type="submit" class="btn-poll-action poll-action-archive" title="Archiver ce sondage">
                        <span>üì¶</span> Archiver
                    </button>
                </form>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <p>Aucun sondage actif.</p>
    {% endif %}
</section>

<section class="card">
    <h2>Sondages archiv√©s</h2>
    {% if archived_polls %}
    <div class="polls-grid">
        {% for poll in archived_polls %}
        <article class="result-card poll-card">
            <p class="slot-label">{{ poll.title }}</p>
            <p class="meta">Type: {{ poll_type_labels.get(poll.poll_type, poll.poll_type) }}</p>
            <p class="meta">Mode: {{ response_mode_labels.get(poll.response_mode, poll.response_mode) }}</p>
            <p class="meta">Participants votants: {{ poll.votes_count }}</p>
            <p class="meta">Archiv√© le: {{ poll.archived_at | datetime_fr }}</p>
            <p><a href="{{ url_for('view_poll', token=poll.token) }}">Voir le sondage</a></p>
            <div class="poll-card-actions">
                <form action="{{ url_for('archive_poll', token=poll.token) }}" method="post"
                    class="poll-card-action-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="action" value="unarchive">
                    <button type="submit">D√©sarchiver</button>
                </form>
                <form id="delete-poll-{{ poll.id }}" action="{{ url_for('delete_poll', token=poll.token) }}"
                    method="post" class="poll-card-action-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="button" class="danger-btn open-delete-poll-modal"
                        data-delete-form-id="delete-poll-{{ poll.id }}"
                        data-poll-title="{{ poll.title }}">Supprimer</button>
                </form>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <p>Aucun sondage archiv√©.</p>
    {% endif %}
</section>

<div id="deletePollModal" class="modal-backdrop" hidden>
    <section class="card modal-card" role="dialog" aria-modal="true" aria-labelledby="deletePollModalTitle">
        <div class="modal-header">
            <h2 id="deletePollModalTitle">Confirmation de suppression</h2>
            <button type="button" id="closeDeletePollModalBtn" class="modal-close-btn" aria-label="Fermer">‚úï</button>
        </div>
        <p id="deletePollModalText" class="sub"></p>
        <div class="form-actions">
            <button type="button" id="confirmDeletePollBtn" class="danger-btn">Oui, supprimer d√©finitivement</button>
            <button type="button" id="cancelDeletePollBtn">Annuler</button>
        </div>
    </section>
</div>
{% endblock %}