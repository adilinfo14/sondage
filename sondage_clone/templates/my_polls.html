{% extends "base.html" %}

{% block content %}
<section class="card hero">
    <h1>Mes sondages</h1>
</section>

<section class="card">
    <h2>Sondages actifs</h2>
    {% if active_polls %}
    <div class="polls-grid">
        {% for poll in active_polls %}
        <article class="result-card poll-card">
            <p class="slot-label">{{ poll.title }}</p>
            <p class="meta">Type: {{ poll_type_labels.get(poll.poll_type, poll.poll_type) }}</p>
            <p class="meta">Mode: {{ response_mode_labels.get(poll.response_mode, poll.response_mode) }}</p>
            <p class="meta">Participants votants: {{ poll.votes_count }}</p>
            <p class="meta">Créé le: {{ poll.created_at | datetime_fr }}</p>
            <p><a href="{{ url_for('view_poll', token=poll.token) }}">Ouvrir le sondage</a></p>
            <div class="poll-card-actions">
                <form action="{{ url_for('archive_poll', token=poll.token) }}" method="post"
                    class="poll-card-action-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="action" value="archive">
                    <button type="submit">Archiver</button>
                </form>
                {% if poll.votes_count == 0 %}
                <a href="{{ url_for('edit_poll_page', token=poll.token) }}" class="poll-card-action-btn">Modifier</a>
                {% else %}
                <span class="meta danger">Modification impossible : des votes existent</span>
                {% endif %}
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <p>Aucun sondage actif.</p>
    {% endif %}
</section>

<section class="card">
    <h2>Sondages archivés</h2>
    {% if archived_polls %}
    <div class="polls-grid">
        {% for poll in archived_polls %}
        <article class="result-card poll-card">
            <p class="slot-label">{{ poll.title }}</p>
            <p class="meta">Type: {{ poll_type_labels.get(poll.poll_type, poll.poll_type) }}</p>
            <p class="meta">Mode: {{ response_mode_labels.get(poll.response_mode, poll.response_mode) }}</p>
            <p class="meta">Participants votants: {{ poll.votes_count }}</p>
            <p class="meta">Archivé le: {{ poll.archived_at | datetime_fr }}</p>
            <p><a href="{{ url_for('view_poll', token=poll.token) }}">Voir le sondage</a></p>
            <div class="poll-card-actions">
                <form action="{{ url_for('archive_poll', token=poll.token) }}" method="post"
                    class="poll-card-action-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="action" value="unarchive">
                    <button type="submit">Désarchiver</button>
                </form>
                <form id="delete-poll-{{ poll.id }}" action="{{ url_for('delete_poll', token=poll.token) }}"
                    method="post" class="poll-card-action-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="button" class="danger-btn open-delete-poll-modal"
                        data-delete-form-id="delete-poll-{{ poll.id }}"
                        data-poll-title="{{ poll.title }}">Supprimer</button>
                </form>
            </div>
        </article>
        {% endfor %}
    </div>
    {% else %}
    <p>Aucun sondage archivé.</p>
    {% endif %}
</section>

<div id="deletePollModal" class="modal-backdrop" hidden>
    <section class="card modal-card" role="dialog" aria-modal="true" aria-labelledby="deletePollModalTitle">
        <div class="modal-header">
            <h2 id="deletePollModalTitle">Confirmation de suppression</h2>
            <button type="button" id="closeDeletePollModalBtn" class="modal-close-btn" aria-label="Fermer">✕</button>
        </div>
        <p id="deletePollModalText" class="sub"></p>
        <div class="form-actions">
            <button type="button" id="confirmDeletePollBtn" class="danger-btn">Oui, supprimer définitivement</button>
            <button type="button" id="cancelDeletePollBtn">Annuler</button>
        </div>
    </section>
</div>
{% endblock %}