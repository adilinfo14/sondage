{% extends "base.html" %}

{% block content %}
<section class="card hero">
    <p class="eyebrow">ğŸ—³ï¸ Sondage style Sondage</p>
    <h1>CrÃ©e un sondage RDV ou avis</h1>
    <p class="sub">Prise de rendez-vous, vote d'Ã©quipe, choix d'idÃ©es: tout en un, avec accÃ¨s organisateur sÃ©curisÃ©.</p>
</section>

<section class="card">
    <form id="createPollForm" action="{{ url_for('create_poll') }}" method="post" class="poll-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <label>
            Titre du sondage
            <input type="text" name="title" placeholder="Ex: RÃ©union projet Mars" required>
        </label>

        <label>
            Type de sondage
            <select name="poll_type">
                <option value="meeting" selected>ğŸ“… RÃ©union / RDV</option>
                <option value="opinion">ğŸ’¡ Prise dâ€™avis / dÃ©cision</option>
                <option value="event">ğŸ‰ Ã‰vÃ©nement</option>
                <option value="training">ğŸ“ Formation</option>
                <option value="shift">ğŸ•’ Planning / permanence</option>
                <option value="meal">ğŸ½ï¸ Sortie / repas</option>
                <option value="trip">âœˆï¸ Voyage / dÃ©placement</option>
            </select>
        </label>

        <label>
            Mode de vote
            <select name="response_mode">
                <option value="availability" selected>DisponibilitÃ©s (Oui / Non)</option>
                <option value="single">Choix unique (1 option parmi N)</option>
                <option value="multiple">Choix multiple (plusieurs options)</option>
            </select>
        </label>

        <label>
            Description (optionnelle)
            <textarea name="description" rows="3" placeholder="Contexte, durÃ©e, lien visio..."></textarea>
        </label>

        <label>
            Nom et prÃ©nom de l'organisateur
            <input type="text" name="creator_name" placeholder="Ex: Ilhan Dupont" required>
        </label>

        <label>
            Date limite de vote (optionnelle)
            <input type="datetime-local" name="deadline_at">
        </label>

        <label>
            Code organisateur (minimum 8 caractÃ¨res)
            <input type="password" name="organizer_code" minlength="8" placeholder="Code secret" required>
        </label>

        <label>
            Emails des participants (optionnel)
            <textarea name="participant_emails" rows="3"
                placeholder="Un email par ligne, ou sÃ©parÃ©s par virgule. Ex: alice@mail.com, bob@mail.com"></textarea>
        </label>

        <label>
            CrÃ©neaux / options (un par ligne)
            <textarea name="slots" rows="7"
                placeholder="Ex RDV:\nLundi 19/02 - 10:00\nLundi 19/02 - 14:00\nMardi 20/02 - 09:30\n\nEx avis:\nOption A\nOption B\nOption C"
                required></textarea>
        </label>

        <label class="consent-row">
            <input type="checkbox" name="rgpd_email_rights">
            <span>Je confirme disposer du consentement des participants avant envoi dâ€™emails dâ€™invitation (version {{
                consent_version }}).</span>
        </label>

        <label class="consent-row">
            <input type="checkbox" name="rgpd_creator" required>
            <span>Jâ€™accepte la <a href="{{ url_for('privacy_policy') }}" target="_blank" rel="noopener">politique de
                    confidentialitÃ© (RGPD)</a> (version {{ consent_version }}).</span>
        </label>

        <div class="form-actions">
            <button type="button" id="previewPollBtn">PrÃ©visualiser le sondage</button>
            <button type="submit" id="submitPollBtn" disabled>CrÃ©er le sondage</button>
        </div>
    </form>
</section>

<div id="pollPreviewModal" class="modal-backdrop" hidden>
    <section class="card modal-card" role="dialog" aria-modal="true" aria-labelledby="previewModalTitle">
        <div class="modal-header">
            <h2 id="previewModalTitle">PrÃ©visualisation avant crÃ©ation</h2>
            <button type="button" id="closePreviewModalBtn" class="modal-close-btn" aria-label="Fermer">âœ•</button>
        </div>
        <p><strong id="previewTitle"></strong></p>
        <p class="meta" id="previewCreator"></p>
        <p class="meta" id="previewType"></p>
        <p class="meta" id="previewMode"></p>
        <p class="meta" id="previewDeadline"></p>
        <p class="meta" id="previewDescription"></p>
        <div>
            <p class="slot-label">Options proposÃ©es</p>
            <ul id="previewSlots"></ul>
        </div>
        <p class="sub">Si tout est correct, ferme cette fenÃªtre puis clique sur Â« CrÃ©er le sondage Â».</p>
    </section>
</div>
{% endblock %}