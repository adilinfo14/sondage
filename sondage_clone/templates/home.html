{% extends "base.html" %}

{% block content %}
<section class="card hero">
    <p class="eyebrow">üó≥Ô∏è Outil de planification et de vote</p>
    <h1>Cr√©er un sondage professionnel</h1>
    <p class="sub">Prise de rendez-vous, vote d'√©quipe, choix d'id√©es: tout en un, avec acc√®s organisateur s√©curis√©.</p>
</section>

<section class="card create-form-card">
    <span class="form-canary fc-left" aria-hidden="true">
        <span class="crest"></span>
        <span class="eye e1"></span>
        <span class="eye e2"></span>
        <span class="wing"></span>
        <span class="beak"></span>
    </span>
    <span class="form-canary fc-right" aria-hidden="true">
        <span class="crest"></span>
        <span class="eye e1"></span>
        <span class="eye e2"></span>
        <span class="wing"></span>
        <span class="beak"></span>
    </span>
    <form id="createPollForm" action="{{ url_for('create_poll') }}" method="post" class="poll-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <label class="full-width">
            Titre du sondage
            <input type="text" name="title" placeholder="Ex: R√©union projet" required>
        </label>

        <label>
            Type de sondage
            <select name="poll_type">
                <option value="meeting" selected>üìÖ R√©union / RDV</option>
                <option value="opinion">üí° Prise d‚Äôavis / d√©cision</option>
                <option value="event">üéâ √âv√©nement</option>
            </select>
        </label>

        <label>
            Mode de vote
            <select name="response_mode">
                <option value="single" selected>Choix unique</option>
                <option value="multiple">Choix multiple</option>
            </select>
        </label>

        <label class="full-width">
            Description (optionnelle)
            <textarea name="description" rows="3" placeholder="Contexte, dur√©e, lien visio..."></textarea>
        </label>

        <label class="full-width">
            Nom et pr√©nom de l'organisateur
            <input type="text" name="creator_name" placeholder="Ex: Pr√©nom Nom" value="{{
                (app_auth_user_email.split('@')[0] | replace('.', ' ') | replace('_', ' ') | title)
                if app_auth_logged_in and app_auth_user_email else ''
            }}" required>
            <span class="meta">Pr√©rempli depuis ton compte, modifiable si besoin.</span>
        </label>

        <label>
            Date limite de vote (optionnelle)
            <input type="datetime-local" name="deadline_at">
        </label>

        <label>
            Code organisateur
            <input type="password" name="organizer_code" minlength="8" placeholder="Minimum 8 caract√®res" required>
            <span class="meta">Prot√®ge l‚Äôacc√®s organisateur.</span>
        </label>

        <label class="full-width">
            Emails des participants (optionnel)
            <textarea name="participant_emails" rows="3"
                placeholder="Un email par ligne, ou s√©par√©s par virgule. Ex: exemple1@email.com, exemple2@email.com"></textarea>
        </label>

        <label class="full-width">
            Cr√©neaux / options (un par ligne)
            <textarea name="slots" rows="7"
                placeholder="Exemple r√©union :&#10;Lundi 19/02 - 10:00&#10;Lundi 19/02 - 14:00&#10;Mardi 20/02 - 09:30&#10;&#10;Exemple avis :&#10;Option A&#10;Option B&#10;Option C"
                required></textarea>
        </label>

        <label class="consent-row">
            <input type="checkbox" name="rgpd_email_rights">
            <span>Je confirme disposer du consentement des participants avant envoi d‚Äôemails d‚Äôinvitation (version {{
                consent_version }}).</span>
        </label>

        <label class="consent-row">
            <input type="checkbox" name="rgpd_creator" required>
            <span>J‚Äôaccepte la <a href="{{ url_for('privacy_policy') }}" target="_blank" rel="noopener">politique de
                    confidentialit√© (RGPD)</a> (version {{ consent_version }}).</span>
        </label>

        <div class="form-actions">
            <button type="button" id="previewPollBtn">‚ö° Pr√©visualisation</button>
            <button type="submit" id="submitPollBtn">Cr√©er le sondage</button>
        </div>
    </form>
</section>

<div id="pollPreviewModal" class="modal-backdrop" hidden>
    <section class="card modal-card" role="dialog" aria-modal="true" aria-labelledby="previewModalTitle">
        <div class="modal-header">
            <h2 id="previewModalTitle">Pr√©visualisation avant cr√©ation</h2>
            <button type="button" id="closePreviewModalBtn" class="modal-close-btn" aria-label="Fermer">‚úï</button>
        </div>
        <div class="preview-shell">
            <section class="preview-panel preview-panel-hero">
                <p class="eyebrow">Aper√ßu en temps r√©el</p>
                <h3 id="previewTitle"></h3>
                <p class="meta" id="previewCreator"></p>
                <p class="meta" id="previewType"></p>
                <p class="meta" id="previewMode"></p>
                <p class="meta" id="previewDeadline"></p>
                <p class="sub" id="previewDescription"></p>
            </section>

            <section class="preview-panel">
                <p class="slot-label">Zone de vote simul√©e</p>
                <div id="previewVoteOptions" class="preview-option-grid"></div>
            </section>

            <section class="preview-panel">
                <p class="slot-label">Rendu des r√©sultats th√©oriques</p>
                <div id="previewResultOptions" class="preview-result-stack"></div>
            </section>
        </div>
        <p class="sub">Si tout est correct, ferme cette fen√™tre puis clique sur ¬´ Cr√©er le sondage ¬ª.</p>
    </section>
</div>
{% endblock %}